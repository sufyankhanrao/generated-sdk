# -*- coding: utf-8 -*-

"""
greenbyteapi

This file was automatically generated by APIMATIC v3.0 (
 https://www.apimatic.io ).
"""

from greenbyteapi.api_helper import APIHelper
from greenbyteapi.configuration import Server
from greenbyteapi.http.api_response import ApiResponse
from greenbyteapi.controllers.base_controller import BaseController
from apimatic_core.request_builder import RequestBuilder
from apimatic_core.response_handler import ResponseHandler
from apimatic_core.types.parameter import Parameter
from greenbyteapi.http.http_method_enum import HttpMethodEnum
from apimatic_core.types.array_serialization_format import SerializationFormats
from apimatic_core.authentication.multiple.single_auth import Single
from greenbyteapi.models.predict_alerts_response import PredictAlertsResponse
from greenbyteapi.exceptions.problem_details_exception import ProblemDetailsException
from greenbyteapi.exceptions.api_exception import APIException


class PredictController(BaseController):

    """A Controller to access Endpoints in the greenbyteapi API."""
    def __init__(self, config):
        super(PredictController, self).__init__(config)

    def get_predict_alerts(self,
                           device_ids,
                           timestamp_start,
                           timestamp_end,
                           site_ids=None,
                           component_ids=None,
                           status=None,
                           severity=None,
                           fields=None,
                           page_size=50,
                           page=1,
                           use_utc=False):
        """Does a GET request to /predict-alerts.

        Gets a list of Predict alerts based on filter criteria. The timestamps
        are in the time zone configured in the Greenbyte Platform. Use the
        useUtc flag to get timestamps in UTC.
        _üîê This endpoint requires the **Predict** endpoint permission._
        _This is a beta feature. Some details might change before it is
        released as a stable version._

        Args:
            device_ids (List[int]): What devices to get alerts for.
            timestamp_start (datetime): The beginning of the time interval to
                get data for (inclusive), in [RFC 3339, section
                5.6](https://tools.ietf.org/html/rfc3339#section-5.6)
                **date-time** format:  * Timestamps ending with 'Z' are
                treated as UTC. Example: "2020-01-01T00:00:00Z" * Time zone
                (UTC) offset timestamps ending with '+HH:mm'/"-HH:mm" are also
                supported. Example: "2020-01-01T02:00:00-02:00" * Other
                timestamps are treated as being in the time zone configured in
                the Greenbyte Platform. Example: "2020-01-01T00:00:00"  The
                start timestamp **is** included in the time interval: for
                example, to select the full month of March 2020, set
                `timestampStart` to "2020-03-01T00:00:00" and `timestampEnd`
                to "2020-04-01T00:00:00".  Timestamps selected in the portal
                will by default be in UTC.
            timestamp_end (datetime): The end of the time interval to get data
                for (exclusive), in [RFC 3339, section
                5.6](https://tools.ietf.org/html/rfc3339#section-5.6)
                **date-time** format:  * Timestamps ending with 'Z' are
                treated as UTC. Example: "2020-01-01T00:00:00Z" * Time zone
                (UTC) offset timestamps ending with '+HH:mm'/"-HH:mm" are also
                supported. Example: "2020-01-01T02:00:00-02:00" * Other
                timestamps are treated as being in the time zone configured in
                the Greenbyte Platform. Example: "2020-01-01T00:00:00"  The
                end timestamp is **not** included in the time interval: for
                example, to select the full month of March 2020, set
                `timestampStart` to "2020-03-01T00:00:00" and `timestampEnd`
                to "2020-04-01T00:00:00".  Timestamps selected in the portal
                will by default be in UTC.
            site_ids (List[int], optional): What sites to get alerts for.
            component_ids (List[int], optional): What components to get alerts
                for.
            status (PredictStatusEnum, optional): Which alert status to get
                alerts for.
            severity (PredictSeverityEnum, optional): What severity of alerts
                to get: high severity or low severity. If not set, both high
                and low severity alerts are included.
            fields (List[str], optional): Which fields to include in the
                response. Valid fields are those defined in the `PredictAlert`
                schema (See Response Type). By default all fields are included.
            page_size (int, optional): The number of items to return per page.
            page (int, optional): Which page to return when the number of
                items exceed the page size.
            use_utc (bool, optional): Set to true to get timestamps in UTC.

        Returns:
            ApiResponse: An object with the response value as well as other
                useful information such as status codes and headers. A list of
                Predict alerts.

        Raises:
            APIException: When an error occurs while fetching the data from
                the remote API. This exception includes the HTTP Response
                code, an error message, and the HTTP body that was received in
                the request.

        """

        return super().new_api_call_builder.request(
            RequestBuilder().server(Server.DEFAULT)
            .path('/predict-alerts')
            .http_method(HttpMethodEnum.GET)
            .query_param(Parameter()
                         .key('deviceIds')
                         .value(device_ids))
            .query_param(Parameter()
                         .key('timestampStart')
                         .value(APIHelper.when_defined(APIHelper.RFC3339DateTime, timestamp_start)))
            .query_param(Parameter()
                         .key('timestampEnd')
                         .value(APIHelper.when_defined(APIHelper.RFC3339DateTime, timestamp_end)))
            .query_param(Parameter()
                         .key('siteIds')
                         .value(site_ids))
            .query_param(Parameter()
                         .key('componentIds')
                         .value(component_ids))
            .query_param(Parameter()
                         .key('status')
                         .value(status))
            .query_param(Parameter()
                         .key('severity')
                         .value(severity))
            .query_param(Parameter()
                         .key('fields')
                         .value(fields))
            .query_param(Parameter()
                         .key('pageSize')
                         .value(page_size))
            .query_param(Parameter()
                         .key('page')
                         .value(page))
            .query_param(Parameter()
                         .key('useUtc')
                         .value(use_utc))
            .header_param(Parameter()
                          .key('accept')
                          .value('application/json'))
            .array_serialization_format(SerializationFormats.CSV)
            .auth(Single('ApiKeyHeaderAuth'))
        ).response(
            ResponseHandler()
            .deserializer(APIHelper.json_deserialize)
            .deserialize_into(PredictAlertsResponse.from_dictionary)
            .is_api_response(True)
            .local_error('400', 'The request cannot be fulfilled due to bad syntax.', ProblemDetailsException)
            .local_error('401', 'The request is missing a valid API key.\n', APIException)
            .local_error('403', 'One of the following:\n* The API key does not authorize access to the requested endpoint because of a missing endpoint permission.\n* The API key does not authorize access to the requested data. Devices, sites or data signals can be limited.\n', APIException)
            .local_error('405', 'The HTTP method is not allowed for the endpoint.', APIException)
            .local_error('429', 'The API key has been used in too many requests in a given amount\nof time. The following headers will be set in the response:\n* `X-Rate-Limit-Limit` ‚Äì The rate limit period (for example\n  "1m", "12h", or "1d").\n* `X-Rate-Limit-Remaining` ‚Äì The remaining number of requests\n  for this period.\n* `X-Rate-Limit-Reset` ‚Äì The UTC timestamp string (in ISO 8601\n  format) when the remaining number of requests resets.\n\nThe limit is currently 1,000 requests/minute per API key and IP\naddress.\n', ProblemDetailsException)
        ).execute()
