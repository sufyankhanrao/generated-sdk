
"""
greenbyteapi

This file was automatically generated by APIMATIC v3.0 (
 https://www.apimatic.io ).
"""

# ruff: noqa: PLR0915, W291
from apimatic_core.utilities.comparison_helper import (
    ComparisonHelper,
)

from greenbyteapi.api_helper import APIHelper
from tests.controllers.controller_test_base import (
    ControllerTestBase,
)


class PlanControllerTests(ControllerTestBase):
    """
    Endpoint tests for validating the API behavior.

    Ensures controller methods execute correctly and produce the expected
    responses using the shared test client and response catcher.
    """

    controller = None

    @classmethod
    def setUpClass(cls):
        """
        Initialize the shared test client and controller for all test methods.
        """
        super().setUpClass()
        cls.controller = cls.client.plan
        cls.response_catcher = cls.controller.http_call_back

    def test_list_task_categories(self):
        """
        Gets a list of task categories._üîê This endpoint requires the **Plan** endpoint
        permission._.
        """
        # Perform the API call through the SDK function
        result = self.controller.list_task_categories()
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"categoryId\":10,\"title\":\"Scheduled maintenance\"},{\"catego"
            "ryId\":20,\"title\":\"Unscheduled maintenance\"}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_comments_for_multiple_tasks(self):
        """
        Gets a list of comments belonging to one or more tasks with given taskIds._üîê
        This endpoint requires the **Plan** endpoint permission._.
        """
        # Parameters for the API call
        task_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        fields = APIHelper.json_deserialize(
            "[\"commentId\",\"text\"]",
        )
        page_size = 50
        page = 1
        use_utc = False

        # Perform the API call through the SDK function
        result = self.controller.list_comments_for_multiple_tasks(
            task_ids,
            fields,
            page_size,
            page,
            use_utc,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"commentId\":10,\"taskId\":1,\"text\":\"Task started\",\"timest"
            "ampCreated\":\"2020-01-01T00:00:00\",\"createdBy\":{\"firstName\":"
            "\"Greenbyte\",\"lastName\":\"Support\"}},{\"commentId\":11,\"taskI"
            "d\":2,\"text\":\"Task finished\",\"timestampCreated\":\"2020-01-02"
            "T00:00:00\",\"createdBy\":{\"firstName\":\"Greenbyte\",\"lastName"
            "\":\"Support\"}}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_site_accesses(self):
        """
        Gets a list of site accesses._üîê This endpoint requires the **Plan** endpoint
        permission._.
        """
        # Parameters for the API call
        timestamp_start = APIHelper.RFC3339DateTime.from_value(
            "2024-01-01T00:00:00Z",
        ).datetime
        timestamp_end = APIHelper.RFC3339DateTime.from_value(
            "2024-01-08T00:00:00Z",
        ).datetime
        device_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        site_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        fields = APIHelper.json_deserialize(
            "[\"siteAccessId\",\"timestampStart\"]",
        )
        page_size = 50
        page = 1
        use_utc = False

        # Perform the API call through the SDK function
        result = self.controller.list_site_accesses(
            timestamp_start,
            timestamp_end,
            device_ids,
            site_ids,
            fields,
            page_size,
            page,
            use_utc,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"siteAccessId\":10,\"siteId\":18,\"deviceIds\":[11,12],\"taskId"
            "s\":[66],\"siteAccessPersonnel\":[{\"personnelId\":1234,\"firstNam"
            "e\":\"Andreas\",\"lastName\":\"Jonsson\",\"company\":\"Power Offta"
            "kers Inc.\",\"phoneNumber\":\"456-123\",\"vehicleRegistration\":\""
            "ABC456\",\"comment\":\"Site access comment\",\"timestampStart\":\""
            "2020-04-30T10:03:00\",\"timestampEnd\":\"2020-04-30T17:39:00\"}],"
            "\"timestampStart\":\"2020-01-01T12:00:00\",\"timestampEndExpected"
            "\":\"2020-01-01T13:00:00\",\"timestampEnd\":\"2020-01-01T13:30:00"
            "\",\"logOnComment\":\"Investigating\",\"logOffComment\":\"All clea"
            "r\"},{\"siteAccessId\":11,\"siteId\":18,\"deviceIds\":[15],\"taskI"
            "ds\":[55,56],\"siteAccessPersonnel\":[{\"personnelId\":2345,\"firs"
            "tName\":\"Andrea\",\"lastName\":\"Larsson\",\"company\":\"Power Of"
            "ftakers Inc.\",\"phoneNumber\":\"123-456\",\"vehicleRegistration\""
            ":\"ABC123\",\"comment\":\"Site access comment\",\"timestampStart\""
            ":\"2020-04-30T10:04:00\",\"timestampEnd\":\"2020-04-30T17:39:00\"}"
            "],\"timestampStart\":\"2020-01-02T12:00:00\",\"timestampEndExpecte"
            "d\":\"2020-01-02T13:00:00\",\"timestampEnd\":\"2020-01-02T13:30:00"
            "\",\"logOnComment\":\"Investigating\",\"logOffComment\":\"All clea"
            "r\"}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_device_accesses_for_multiple_site_accesses(self):
        """
        Gets a list of device accesses belonging to site accesses with specified
        SiteAccessIds._üîê This endpoint requires the **Plan** endpoint permission._.
        """
        # Parameters for the API call
        site_access_ids = APIHelper.json_deserialize(
            "[1,2]",
        )
        fields = APIHelper.json_deserialize(
            "[\"deviceAccessId\",\"siteId\"]",
        )
        page_size = 50
        page = 1
        use_utc = False

        # Perform the API call through the SDK function
        result = self.controller.list_device_accesses_for_multiple_site_accesses(
            site_access_ids,
            fields,
            page_size,
            page,
            use_utc,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"deviceAccessId\":1504,\"siteId\":50,\"siteAccessId\":1,\"devic"
            "eIds\":[15],\"personnelIds\":[11,12],\"taskIds\":[55],\"timestampS"
            "tart\":\"2020-01-02T12:00:00\",\"timestampEnd\":\"2020-01-02T12:55"
            ":00\",\"timestampEndExpected\":\"2020-01-02T13:00:00\",\"logOnComm"
            "ent\":\"TOC at 12:01\",\"logOffComment\":\"Access completed\"},{\""
            "deviceAccessId\":1560,\"siteId\":50,\"siteAccessId\":2,\"deviceIds"
            "\":[15],\"personnelIds\":[11,12],\"taskIds\":[55],\"timestampStart"
            "\":\"2020-01-02T13:00:00\",\"timestampEnd\":\"2020-01-02T13:55:00"
            "\",\"timestampEndExpected\":\"2020-01-02T14:00:00\",\"logOnComment"
            "\":\"TOC at 13:01\",\"logOffComment\":\"Access completed\"}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_downtime_events(self):
        """
        Gets a list of downtime events._üîê This endpoint requires the **Plan** endpoint
        permission._.
        """
        # Parameters for the API call
        timestamp_start = APIHelper.RFC3339DateTime.from_value(
            "2024-01-01T00:00:00Z",
        ).datetime
        timestamp_end = APIHelper.RFC3339DateTime.from_value(
            "2024-01-08T00:00:00Z",
        ).datetime
        device_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        site_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        fields = APIHelper.json_deserialize(
            "[\"deviceIds\",\"timestampStart\"]",
        )
        page_size = 50
        page = 1
        use_utc = False

        # Perform the API call through the SDK function
        result = self.controller.list_downtime_events(
            timestamp_start,
            timestamp_end,
            device_ids,
            site_ids,
            fields,
            page_size,
            page,
            use_utc,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"downtimeEventId\":1,\"deviceIds\":[1,2,3],\"timestampStart\":"
            "\"2020-01-01T00:00:00\",\"timestampEnd\":\"2020-01-02T00:00:00\","
            "\"comment\":\"Planned downtime\",\"siteIds\":[],\"taskIds\":[1358]"
            ",\"remainingCapacityPercentage\":10},{\"downtimeEventId\":2,\"devi"
            "ceIds\":[1,2,3],\"timestampStart\":\"2020-01-10T00:00:00\",\"times"
            "tampEnd\":\"2020-01-12T00:00:00\",\"comment\":\"Unplanned downtime"
            "\",\"siteIds\":[1],\"taskIds\":[1359],\"remainingCapacityPercentag"
            "e\":0}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_personnel(self):
        """
        Gets a list of personnel._üîê This endpoint requires the **Plan** endpoint
        permission._.
        """
        # Parameters for the API call
        fields = APIHelper.json_deserialize(
            "[\"lastName\",\"phone\"]",
        )
        page_size = 50
        page = 1

        # Perform the API call through the SDK function
        result = self.controller.list_personnel(
            fields,
            page_size,
            page,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"personnelId\":5,\"firstName\":\"Greenbyte\",\"lastName\":\"Sup"
            "port\",\"email\":\"support@greenbyte.com\",\"phone\":\"123-456\","
            "\"mobile\":\"654-321\",\"organization\":{\"organizationId\":10,\"n"
            "ame\":\"Power Offtakers Inc.\",\"email\":\"support@power-offtakers"
            ".example.com\",\"phone\":\"456-789\"},\"qualifications\":[{\"quali"
            "ficationId\":85,\"manufacturer\":\"GE\",\"qualificationType\":\"AP"
            "\",\"qualificationDescription\":\"Authorized Person\"}],\"siteIndu"
            "ctions\":[{\"siteInductionId\":43,\"siteId\":1,\"dateExpires\":\"2"
            "020-12-01\"}]}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_organizations(self):
        """
        Gets a list of organizations._üîê This endpoint requires the **Plan** endpoint
        permission._.
        """
        # Perform the API call through the SDK function
        result = self.controller.list_organizations()
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"organizationId\":10,\"name\":\"Power Offtakers Inc.\",\"email"
            "\":\"support@power-offtakers.example.com\",\"phone\":\"456-789\"}]"
            "",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_hse_incidents(self):
        """
        Gets a list of HSE incidents._üîê This endpoint requires the **Plan** endpoint
        permission.__This is a beta feature. Some details might change before it is
        released as a stable version._.
        """
        # Parameters for the API call
        timestamp_start = APIHelper.RFC3339DateTime.from_value(
            "2024-01-01T00:00:00Z",
        ).datetime
        timestamp_end = APIHelper.RFC3339DateTime.from_value(
            "2024-01-08T00:00:00Z",
        ).datetime
        site_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        state = "unresolved"
        category = "Accident"
        use_utc = False

        # Perform the API call through the SDK function
        result = self.controller.list_hse_incidents(
            timestamp_start,
            timestamp_end,
            site_ids,
            state,
            category,
            use_utc,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"hseIncidentId\":10,\"siteId\":5,\"deviceId\":1,\"timestamp\":"
            "\"2022-12-18T09:45:00\",\"hseCategory\":\"HazardObservation\",\"lo"
            "stTimeInjury\":false,\"incidentDescription\":\"Broken ladder\",\"r"
            "esolved\":false,\"resolvedTimestamp\":null}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_list_worklog_items(self):
        """
        Gets a list of worklog items._üîê This endpoint requires the **Plan** endpoint
        permission.__This is a beta feature. Some details might change before it is
        released as a stable version._.
        """
        # Parameters for the API call
        timestamp_start = APIHelper.RFC3339DateTime.from_value(
            "2024-01-01T00:00:00Z",
        ).datetime
        timestamp_end = APIHelper.RFC3339DateTime.from_value(
            "2024-01-08T00:00:00Z",
        ).datetime
        site_ids = APIHelper.json_deserialize(
            "[1,2,3]",
        )
        use_utc = False

        # Perform the API call through the SDK function
        result = self.controller.list_worklog_items(
            timestamp_start,
            timestamp_end,
            site_ids,
            use_utc,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json; charset=utf-8",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "[{\"worklogItemId\":10,\"timestamp\":\"2023-01-08T00:00:00\",\"sit"
            "eId\":5,\"hoursWorked\":2.5,\"comment\":\"Inverter B Offline With "
            "Repeated Fault\\n- Work Performed: INV B was cleaned\\n\"}]",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

