# -*- coding: utf-8 -*-

"""
fortisapi

This file was automatically generated by APIMATIC v3.0 (
 https://www.apimatic.io ).
"""

import json

from tests.controllers.controller_test_base import ControllerTestBase
from apimatic_core.utilities.comparison_helper import ComparisonHelper
from fortisapi.api_helper import APIHelper
from fortisapi.models.page import Page
from fortisapi.models.order_19 import Order19
from fortisapi.models.filter_by import FilterBy


class BatchesControllerTests(ControllerTestBase):

    controller = None

    @classmethod
    def setUpClass(cls):
        super(BatchesControllerTests, cls).setUpClass()
        cls.controller = cls.client.batches
        cls.response_catcher = cls.controller.http_call_back

    # List All Batches
    def test_list_all_batches(self):
        # Parameters for the API call
        page = None
        order = None
        filter_by = None
        expand = None
        format = None
        typeahead = None
        fields = None

        # Perform the API call through the SDK function
        result = self.controller.list_all_batches(page, order, filter_by, expand, format, typeahead, fields)

        # Test response code
        assert self.response_catcher.response.status_code == 200

        # Test headers
        expected_headers = {}
        expected_headers['content-type'] = 'application/json'

        assert ComparisonHelper.match_headers(expected_headers, self.response_catcher.response.headers)

        
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize('{"type":"BatchsCollection","list":[{"id":"11e95f8ec39de8fbdb0a4f1a'
            '","created_ts":1422040992,"product_transaction_id":"11e95f8ec39de8'
            'fbdb0a4f1a","processing_status_id":2,"batch_num":4,"is_open":0,"se'
            'ttlement_file_name":"settement_file.txt","batch_close_ts":15314236'
            '93,"batch_close_detail":"BATCH_MISMATCH","total_sale_amount":2342,'
            '"total_sale_count":21,"total_refund_amount":2342,"total_refund_cou'
            'nt":18,"total_void_amount":2342,"total_void_count":17,"total_blind'
            '_refund_amount":2342,"total_blind_refund_count":16,"changelogs":[{'
            '"id":"11e95f8ec39de8fbdb0a4f1a","created_ts":1422040992,"action":"'
            'CREATE","model":"TransactionRequest","model_id":"11ec829598f0d4008'
            'be9aba4","user_id":"11e95f8ec39de8fbdb0a4f1a","changelog_details":'
            '[{"id":"11e95f8ec39de8fbdb0a4f1a","changelog_id":"11e95f8ec39de8fb'
            'db0a4f1a","field":"next_run_ts","old_value":"1643616000"}],"user":'
            '{"id":"11e95f8ec39de8fbdb0a4f1a","username":"email@domain.com","fi'
            'rst_name":"Bob","last_name":"Fairview"}}],"postback_logs":[{"id":"'
            '11e95f8ec39de8fbdb0a4f1a","postback_config_id":"11e95f8ec39de8fbdb'
            '0a4f1a","changelog_id":"11e95f8ec39de8fbdb0a4f1a","next_run_ts":14'
            '22040992,"created_ts":1422040992,"model_id":"11e95f8ec39de8fbdb0a4'
            'f1a"}],"product_transaction":{"processor_version":"1_0_0","title":'
            '"My terminal","payment_method":"cc","processor":"zgate","mcc":"111'
            '1","tax_surcharge_config":2,"partner":"standalone","location_id":"'
            '11e95f8ec39de8fbdb0a4f1a","surcharge":{},"processor_data":{},"vt_c'
            'lerk_number":true,"vt_billing_phone":true,"vt_enable_tip":true,"ac'
            'h_allow_debit":true,"ach_allow_credit":true,"ach_allow_refund":tru'
            'e,"vt_cvv":true,"vt_street":true,"vt_zip":true,"vt_order_num":true'
            ',"vt_enable":true,"receipt_show_contact_name":true,"display_avs":t'
            'rue,"card_type_visa":true,"card_type_mc":true,"card_type_disc":tru'
            'e,"card_type_amex":true,"card_type_diners":true,"card_type_jcb":tr'
            'ue,"invoice_location":true,"allow_partial_authorization":true,"all'
            'ow_recurring_partial_authorization":true,"auto_decline_cvv":true,"'
            'auto_decline_street":true,"auto_decline_zip":true,"split_payments_'
            'allow":true,"vt_show_custom_fields":true,"receipt_show_custom_fiel'
            'ds":true,"vt_override_sales_tax_allowed":true,"vt_enable_sales_tax'
            '":true,"vt_require_zip":true,"vt_require_street":true,"auto_declin'
            'e_cavv":true,"current_batch":34,"dup_check_per_batch":null,"paylin'
            'k_allow":false,"quick_invoice_allow":false,"level3_allow":false,"p'
            'ayfac_enable":false,"sales_office_id":"11e95f8ec39de8fbdb0a4f1a","'
            'hosted_payment_page_allow":false,"surcharge_id":"11e95f8ec39de8fbd'
            'b0a4f1a","level3_default":{},"cau_subscribe_type_id":0,"location_b'
            'illing_account_id":"11eb88b873980c64a21e5fd2","product_billing_gro'
            'up_id":"nofees","account_number":"12345678","run_avs_on_accountvau'
            'lt_create":false,"accountvault_expire_notification_email_enable":f'
            'alse,"debit_allow_void":false,"quick_invoice_text_to_pay":false,"s'
            'ms_enable":false,"vt_show_currency":true,"receipt_show_currency":f'
            'alse,"allow_blind_refund":false,"vt_show_company_name":false,"rece'
            'ipt_show_company_name":false,"bank_funded_only":false,"require_cvv'
            '_on_keyed_cnp":true,"require_cvv_on_tokenized_cnp":true,"show_seco'
            'ndary_amount":false,"allow_secondary_amount":false,"show_google_pa'
            'y":true,"show_apple_pay":true,"id":"11e95f8ec39de8fbdb0a4f1a","act'
            'ive":true,"created_ts":1422040992,"modified_ts":1422040992,"create'
            'd_user_id":"11e95f8ec39de8fbdb0a4f1a","modified_user_id":"11e95f8e'
            'c39de8fbdb0a4f1a","product_transaction_api_id":"11e95f8ec39de8fbdb'
            '0a4f1a","is_secondary_amount_allowed":false,"batch_risk_config":{}'
            ',"fortis_id":"8149742","product_billing_group_code":"nofees","cau_'
            'subscribe_type_code":0}}],"links":{"type":"Links","first":"/v1/end'
            'point?page[size]=10&page[number]=1","previous":"/v1/endpoint?page['
            'size]=10&page[number]=5","next":"/v1/endpoint?page[size]=10&page[n'
            'umber]=7","last":"/v1/endpoint?page[size]=10&page[number]=42"},"pa'
            'gination":{"type":"Pagination","total_count":423,"page_count":42,"'
            'page_number":6,"page_size":10},"sort":{"type":"Sorting","fields":['
            '{"field":"last_name","order":"asc"}]}}')
        received_body = APIHelper.json_deserialize(self.response_catcher.response.text)
        assert ComparisonHelper.match_body(expected_body, received_body)

    # Settle a Batch
    def test_settle_a_batch(self):
        # Parameters for the API call
        batch_id = '11e95f8ec39de8fbdb0a4f1a'

        # Perform the API call through the SDK function
        result = self.controller.settle_a_batch(batch_id)

        # Test response code
        assert self.response_catcher.response.status_code == 202

        # Test headers
        expected_headers = {}
        expected_headers['content-type'] = 'application/json'

        assert ComparisonHelper.match_headers(expected_headers, self.response_catcher.response.headers)

        
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize('{"type":"AsyncProcessing","data":{"async":{"code":"406c66c3-21cb-4'
            '7fb-80fc-843bc42507fb","link":"/v1/async/status/406c66c3-21cb-47fb'
            '-80fc-843bc42507fb"}}}')
        received_body = APIHelper.json_deserialize(self.response_catcher.response.text)
        assert ComparisonHelper.match_body(expected_body, received_body)

