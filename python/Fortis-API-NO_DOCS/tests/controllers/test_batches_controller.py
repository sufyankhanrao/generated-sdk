
"""
fortisapi

This file was automatically generated by APIMATIC v3.0 (
 https://www.apimatic.io ).
"""

# ruff: noqa: PLR0915, W291
from apimatic_core.utilities.comparison_helper import (
    ComparisonHelper,
)

from fortisapi.api_helper import APIHelper
from tests.controllers.controller_test_base import (
    ControllerTestBase,
)


class BatchesControllerTests(ControllerTestBase):
    """
    Endpoint tests for validating the API behavior.

    Ensures controller methods execute correctly and produce the expected
    responses using the shared test client and response catcher.
    """

    controller = None

    @classmethod
    def setUpClass(cls):
        """
        Initialize the shared test client and controller for all test methods.
        """
        super().setUpClass()
        cls.controller = cls.client.batches
        cls.response_catcher = cls.controller.http_call_back

    def test_list_all_batches(self):
        """
        List All Batches.
        """
        # Parameters for the API call
        page = None
        order = None
        filter_by = None
        expand = None
        format = None
        typeahead = None
        fields = None

        # Perform the API call through the SDK function
        result = self.controller.list_all_batches(
            page,
            order,
            filter_by,
            expand,
            format,
            typeahead,
            fields,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 200
        # Test headers
        expected_headers = {
            "content-type": "application/json",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "{\"type\":\"BatchsCollection\",\"list\":[{\"id\":\"11e95f8ec39de8f"
            "bdb0a4f1a\",\"created_ts\":1422040992,\"product_transaction_id\":"
            "\"11e95f8ec39de8fbdb0a4f1a\",\"processing_status_id\":2,\"batch_nu"
            "m\":4,\"is_open\":0,\"settlement_file_name\":\"settement_file.txt"
            "\",\"batch_close_ts\":1531423693,\"batch_close_detail\":\"BATCH_MI"
            "SMATCH\",\"total_sale_amount\":2342,\"total_sale_count\":21,\"tota"
            "l_refund_amount\":2342,\"total_refund_count\":18,\"total_void_amou"
            "nt\":2342,\"total_void_count\":17,\"total_blind_refund_amount\":23"
            "42,\"total_blind_refund_count\":16,\"changelogs\":[{\"id\":\"11e95"
            "f8ec39de8fbdb0a4f1a\",\"created_ts\":1422040992,\"action\":\"CREAT"
            "E\",\"model\":\"TransactionRequest\",\"model_id\":\"11ec829598f0d4"
            "008be9aba4\",\"user_id\":\"11e95f8ec39de8fbdb0a4f1a\",\"changelog_"
            "details\":[{\"id\":\"11e95f8ec39de8fbdb0a4f1a\",\"changelog_id\":"
            "\"11e95f8ec39de8fbdb0a4f1a\",\"field\":\"next_run_ts\",\"old_value"
            "\":\"1643616000\"}],\"user\":{\"id\":\"11e95f8ec39de8fbdb0a4f1a\","
            "\"username\":\"email@domain.com\",\"first_name\":\"Bob\",\"last_na"
            "me\":\"Fairview\"}}],\"postback_logs\":[{\"id\":\"11e95f8ec39de8fb"
            "db0a4f1a\",\"postback_config_id\":\"11e95f8ec39de8fbdb0a4f1a\",\"c"
            "hangelog_id\":\"11e95f8ec39de8fbdb0a4f1a\",\"next_run_ts\":1422040"
            "992,\"created_ts\":1422040992,\"model_id\":\"11e95f8ec39de8fbdb0a4"
            "f1a\"}],\"product_transaction\":{\"processor_version\":\"1_0_0\","
            "\"title\":\"My terminal\",\"payment_method\":\"cc\",\"processor\":"
            "\"zgate\",\"mcc\":\"1111\",\"tax_surcharge_config\":2,\"partner\":"
            "\"standalone\",\"location_id\":\"11e95f8ec39de8fbdb0a4f1a\",\"surc"
            "harge\":{},\"processor_data\":{},\"vt_clerk_number\":true,\"vt_bil"
            "ling_phone\":true,\"vt_enable_tip\":true,\"ach_allow_debit\":true,"
            "\"ach_allow_credit\":true,\"ach_allow_refund\":true,\"vt_cvv\":tru"
            "e,\"vt_street\":true,\"vt_zip\":true,\"vt_order_num\":true,\"vt_en"
            "able\":true,\"receipt_show_contact_name\":true,\"display_avs\":tru"
            "e,\"card_type_visa\":true,\"card_type_mc\":true,\"card_type_disc\""
            ":true,\"card_type_amex\":true,\"card_type_diners\":true,\"card_typ"
            "e_jcb\":true,\"invoice_location\":true,\"allow_partial_authorizati"
            "on\":true,\"allow_recurring_partial_authorization\":true,\"auto_de"
            "cline_cvv\":true,\"auto_decline_street\":true,\"auto_decline_zip\""
            ":true,\"split_payments_allow\":true,\"vt_show_custom_fields\":true"
            ",\"receipt_show_custom_fields\":true,\"vt_override_sales_tax_allow"
            "ed\":true,\"vt_enable_sales_tax\":true,\"vt_require_zip\":true,\"v"
            "t_require_street\":true,\"auto_decline_cavv\":true,\"current_batch"
            "\":34,\"dup_check_per_batch\":null,\"paylink_allow\":false,\"quick"
            "_invoice_allow\":false,\"level3_allow\":false,\"payfac_enable\":fa"
            "lse,\"sales_office_id\":\"11e95f8ec39de8fbdb0a4f1a\",\"hosted_paym"
            "ent_page_allow\":false,\"surcharge_id\":\"11e95f8ec39de8fbdb0a4f1a"
            "\",\"level3_default\":{},\"cau_subscribe_type_id\":0,\"location_bi"
            "lling_account_id\":\"11eb88b873980c64a21e5fd2\",\"product_billing_"
            "group_id\":\"nofees\",\"account_number\":\"12345678\",\"run_avs_on"
            "_accountvault_create\":false,\"accountvault_expire_notification_em"
            "ail_enable\":false,\"debit_allow_void\":false,\"quick_invoice_text"
            "_to_pay\":false,\"sms_enable\":false,\"vt_show_currency\":true,\"r"
            "eceipt_show_currency\":false,\"allow_blind_refund\":false,\"vt_sho"
            "w_company_name\":false,\"receipt_show_company_name\":false,\"bank_"
            "funded_only\":false,\"require_cvv_on_keyed_cnp\":true,\"require_cv"
            "v_on_tokenized_cnp\":true,\"show_secondary_amount\":false,\"allow_"
            "secondary_amount\":false,\"show_google_pay\":true,\"show_apple_pay"
            "\":true,\"id\":\"11e95f8ec39de8fbdb0a4f1a\",\"active\":true,\"crea"
            "ted_ts\":1422040992,\"modified_ts\":1422040992,\"created_user_id\""
            ":\"11e95f8ec39de8fbdb0a4f1a\",\"modified_user_id\":\"11e95f8ec39de"
            "8fbdb0a4f1a\",\"product_transaction_api_id\":\"11e95f8ec39de8fbdb0"
            "a4f1a\",\"is_secondary_amount_allowed\":false,\"batch_risk_config"
            "\":{},\"fortis_id\":\"8149742\",\"product_billing_group_code\":\"n"
            "ofees\",\"cau_subscribe_type_code\":0}}],\"links\":{\"type\":\"Lin"
            "ks\",\"first\":\"/v1/endpoint?page[size]=10&page[number]=1\",\"pre"
            "vious\":\"/v1/endpoint?page[size]=10&page[number]=5\",\"next\":\"/"
            "v1/endpoint?page[size]=10&page[number]=7\",\"last\":\"/v1/endpoint"
            "?page[size]=10&page[number]=42\"},\"pagination\":{\"type\":\"Pagin"
            "ation\",\"total_count\":423,\"page_count\":42,\"page_number\":6,\""
            "page_size\":10},\"sort\":{\"type\":\"Sorting\",\"fields\":[{\"fiel"
            "d\":\"last_name\",\"order\":\"asc\"}]}}",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

    def test_settle_a_batch(self):
        """
        Settle a Batch.
        """
        # Parameters for the API call
        batch_id = "11e95f8ec39de8fbdb0a4f1a"

        # Perform the API call through the SDK function
        result = self.controller.settle_a_batch(
            batch_id,
        )
        # Test response code
        assert self.response_catcher.response.status_code == 202
        # Test headers
        expected_headers = {
            "content-type": "application/json",
        }

        assert ComparisonHelper.match_headers(
            expected_headers,
            self.response_catcher.response.headers,
        )
        # Test whether the captured response is as we expected
        assert result is not None
        expected_body = APIHelper.json_deserialize(
            "{\"type\":\"AsyncProcessing\",\"data\":{\"async\":{\"code\":\"406c"
            "66c3-21cb-47fb-80fc-843bc42507fb\",\"link\":\"/v1/async/status/406"
            "c66c3-21cb-47fb-80fc-843bc42507fb\"}}}",
        )
        received_body = APIHelper.json_deserialize(
            self.response_catcher.response.text,
        )
        assert ComparisonHelper.match_body(
            expected_body,
            received_body,
        )

